<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>masimplo's blog | Entity Framework Proxy GetType() mess</title>
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <meta property="og:title" content="Entity Framework Proxy GetType() mess">
  <meta property="og:type" content="website">
  <meta property="og:url" content="/posts/entity-framework-proxy-gettype-mess">
  <meta property="og:description" content="">
  <meta property="og:site_name" content="masimplo's blog">
  <meta property="og:image" content="/assets/og-image.jpg">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:url" content="/posts/entity-framework-proxy-gettype-mess">
  <meta name="twitter:title" content="Entity Framework Proxy GetType() mess">
  <meta name="twitter:description" content="">
  <meta name="twitter:image" content="/assets/og-image.jpg">

  <link rel="apple-touch-icon" href="/assets/apple-touch-icon.png">
  <link href="/feed.xml" type="application/rss+xml" rel="alternate" title="masimplo's blog Last 10 blog posts" />

  
    <link type="text/css" rel="stylesheet" href="/assets/light.css">
  
</head>

<body>
  <main role="main">
    <div class="grid grid-centered">
      <div class="grid-cell">
        <nav class="header-nav reveal">
  <a href="" class="header-logo" title="masimplo's blog">masimplo's blog</a>
  <ul class="header-links">
    
      <li>
        <a href="https://twitter.com/masimplo" target="_blank" title="Twitter">
          <span class="icon icon-social-twitter"></span>
        </a>
      </li>
    
    
    
      <li>
        <a href="https://github.com/masimplo" target="_blank" title="GitHub">
          <span class="icon icon-social-github"></span>
        </a>
      </li>
    
    
    
      <li>
        <a href="https://www.linkedin.com/in/masimplo" target="_blank" title="LinkedIn">
          <span class="icon icon-social-linkedin"></span>
        </a>
      </li>
    
    
    
      <li>
        <a href="mailto:masimplo@gmail.com" target="_blank" title="Email">
          <span class="icon icon-at"></span>
        </a>
      </li>
    
    
      <li>
        <a href="/feed.xml" target="_blank" title="RSS">
          <span class="icon icon-social-rss"></span>
        </a>
      </li>
    
  </ul>
</nav>

        <article class="article reveal">
          <header class="article-header">
            <h1>Entity Framework Proxy GetType() mess</h1>
            <p></p>
            <div class="article-list-footer">
              <span class="article-list-date">
                July 6, 2011
              </span>
              <span class="article-list-divider">-</span>
              <span class="article-list-minutes">
                
                
                  1 minute read
                
              </span>
              <span class="article-list-divider">-</span>
              <div class="article-list-tags">
                
                  <a href="/tag/dotnet">dotnet</a>
                
              </div>
            </div>
          </header>

          <div class="article-content">
            <p>Δουλεύοντας με το Entity Framework του .Net και έχοντας υλοποιήσει ένα Repository Pattern με generics βρέθηκα στην θέση να πρέπει να φτιάξω ένα Repository αγνώστου, μέχρι το runtime, τύπου οπότε έκανα κάτι του στυλ:</p>

<p>….</p>

<p>Όσο έφτιαχνα νέα entities αυτό το chunk δούλευε απροβλημάτιστα. Μόλις όμως άρχισα να σηκώνω entities από το framework για editing τα exceptions δεν είχαν σταματημό. Το πρόβλημα δημιουργήθηκε από το γεγονός ότι τα entities που γυρνάει το EF είναι proxies που κάνουν inherit τον τύπο του εκάστοτε entity και όχι τύπου entity.</p>

<p>Η πρώτη μου σκέψη ήταν αν η MS θα είχε καταχωνιάσει κάπου τον τύπο του entity μέσα στα properties των dynamic proxies. Πουθενά όμως, εκτός από το αναμενόμενο base type το οποίο όμως δημιουργούσε άλλα προβλήματα αν κάποια entities έχουν πάνω από ένα επίπεδα inheritance όπως τα δικά μου.</p>

<p>Μετά από αρκετό ψάξιμο, μιας και searches του στυλ: *“dynamic proxies gettype originating type” *γελούσαν στα μούτρα μου,βρήκα ένα γλυκύτατο <a href="http://msdn.microsoft.com/en-us/library/system.data.objects.objectcontext.getobjecttype.aspx">static method</a> μέσα στο ObjectContext που έδεινε τον Entity Type για Dynamic proxy entities αλλά δεν παραπονιόταν και στα POCO, οπότε ήταν ότι χρειαζόμουν για να κάνω το προβληματικό chunk exception free (τουλάχιστον του συγκεκριμένου :P).</p>
<div class="highlighter-rouge"><pre class="highlight"><code>public static bool IsProxy(object type) {     
   return type != null &amp;&amp; ObjectContext.GetObjectType(type.GetType()) != type.GetType();
}
</code></pre>
</div>


          </div>

          <div class="article-share">
            
            <a href="" title="Share on Twitter" onclick="window.open('https://twitter.com/home?status=Entity Framework Proxy GetType() mess - /posts/entity-framework-proxy-gettype-mess by @masimplo', 'newwindow', 'width=500, height=225'); return false;">
              <span class="icon icon-social-twitter"></span>
            </a>
            <a href="" title="Share on Facebook" onclick="window.open('https://www.facebook.com/sharer/sharer.php?u=/posts/entity-framework-proxy-gettype-mess', 'newwindow', 'width=500, height=500'); return false;">
              <span class="icon icon-social-facebook"></span>
            </a>
            <a href="" title="Share on Google+" onclick="window.open('https://plus.google.com/share?url=/posts/entity-framework-proxy-gettype-mess', 'newwindow', 'width=550, height=400'); return false;">
              <span class="icon icon-social-googleplus"></span>
            </a>
          </div>

          
        </article>
        <footer class="footer reveal">

</footer>

      </div>
    </div>
  </main>
  <script type="text/javascript" src="/assets/vendor.js"></script>
<script type="text/javascript" src="/assets/application.js"></script>

<script src="https://ajax.googleapis.com/ajax/libs/webfont/1.6.16/webfont.js"></script>
<script>
  WebFont.load({
    google: {
      families: ['Cormorant Garamond:700', 'Lato:300,400,700']
    }
  });
</script>


  <script>
    window.ga=function(){ga.q.push(arguments)};ga.q=[];ga.l=+new Date;
    ga('create','UA-28844594-2','auto');ga('send','pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>


</body>
</html>